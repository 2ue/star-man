services:
  star-man:
    image: ghcr.io/2ue/star-man:latest
    container_name: star-man
    restart: unless-stopped

    environment:
      NODE_ENV: production
      GITHUB_TOKEN: ${GITHUB_TOKEN}
      DATABASE_URL: file:///app/data/star-man.db
      API_PORT: 3801
      API_HOST: 0.0.0.0

    ports:
      - "${HOST_PORT:-3800}:3800"  # Web UI + API (通过 nginx 反向代理)

    volumes:
      - ./data:/app/data

    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3800/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
